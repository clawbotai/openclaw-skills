<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Pensi√≥n ‚Äî Colombia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="min-h-screen">

<!-- Error Toast -->
<div id="error-toast" class="error-toast hidden"></div>

<!-- Header -->
<header class="bg-slate-900 border-b border-slate-700 py-4 px-6">
  <div class="max-w-4xl mx-auto flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">P</div>
      <div>
        <h1 class="text-white font-semibold text-lg leading-tight" data-i18n="app.title">Calculadora Pensional</h1>
        <p class="text-slate-400 text-xs" data-i18n="app.subtitle">R√©gimen de Prima Media ‚Ä¢ Colombia</p>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <button id="btn-lang" onclick="toggleLanguage()" class="text-slate-400 hover:text-white text-xs border border-slate-600 px-2 py-1 rounded">English</button>
      <button id="btn-start-over" class="text-slate-400 hover:text-white text-sm hidden" data-i18n="app.startOver">‚Üê Inicio</button>
    </div>
  </div>
</header>

<main class="max-w-4xl mx-auto px-4 py-8">

  <!-- VISTA 1: Bienvenida -->
  <div id="view-welcome" class="hidden">
    <div class="text-center mb-12 mt-8">
      <div class="w-20 h-20 bg-blue-600 rounded-2xl flex items-center justify-center text-white text-3xl font-bold mx-auto mb-6">P</div>
      <h2 class="text-3xl font-bold text-white mb-3" data-i18n="welcome.title">Calcule su Pensi√≥n</h2>
      <p class="text-slate-400 max-w-md mx-auto" data-i18n="welcome.desc">Analice su historia laboral de Colpensiones y conozca su proyecci√≥n pensional bajo la Ley 797 de 2003</p>
    </div>

    <div class="max-w-md mx-auto">
      <label class="block text-slate-300 text-sm font-medium mb-2" data-i18n="welcome.cedula">N√∫mero de C√©dula</label>
      <input type="text" id="input-cedula" placeholder="Ingrese su n√∫mero de c√©dula" 
             class="mb-4" inputmode="numeric" pattern="[0-9]*" autocomplete="off">
      <button id="btn-cedula" 
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors"
              data-i18n="welcome.continue">
        Continuar
      </button>
      <p class="text-slate-500 text-xs text-center mt-4">
        Su c√©dula se usa como contrase√±a para descifrar el PDF de Colpensiones.<br>
        No almacenamos ning√∫n dato ‚Äî todo se procesa en su navegador.
      </p>
    </div>
  </div>

  <!-- VISTA 2: Carga de archivo -->
  <div id="view-upload" class="hidden">
    <div class="text-center mb-8">
      <h2 class="text-2xl font-bold text-white mb-2">Cargue su documento</h2>
      <p class="text-slate-400">Suba el PDF o Excel de su historia laboral de Colpensiones</p>
    </div>

    <div id="drop-zone" class="drop-zone max-w-lg mx-auto rounded-xl p-12 text-center">
      <div class="text-5xl mb-4">üìÑ</div>
      <p class="text-white font-medium mb-2">Arrastre su archivo aqu√≠</p>
      <p class="text-slate-400 text-sm mb-4">o haga clic para seleccionar</p>
      <p class="text-slate-500 text-xs">PDF (protegido con c√©dula) o Excel ‚Ä¢ M√°x. 20MB</p>
      <input type="file" id="file-input" accept=".pdf,.xlsx,.xls,.csv" class="hidden">
    </div>
    <p id="file-name" class="text-center text-slate-400 text-sm mt-4"></p>

    <div class="text-center mt-6">
      <button id="btn-back-upload" class="text-slate-400 hover:text-white text-sm">‚Üê Cambiar c√©dula</button>
    </div>
  </div>

  <!-- VISTA: Cargando -->
  <div id="view-loading" class="hidden">
    <div class="text-center py-20">
      <div class="spinner mx-auto mb-6"></div>
      <p id="loading-text" class="text-white text-lg">Procesando...</p>
      <p class="text-slate-400 text-sm mt-2">Todo se procesa localmente en su navegador</p>
    </div>
  </div>

  <!-- VISTA 3: T√©rminos de Servicio -->
  <div id="view-terms" class="hidden">
    <div class="max-w-2xl mx-auto">
      <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
        <h2 class="text-xl font-bold text-white mb-4">T√©rminos de Servicio</h2>
        
        <div class="terms-content bg-slate-900 rounded-lg p-4 text-sm text-slate-300 leading-relaxed mb-6">
          <p class="mb-3"><strong>AVISO LEGAL IMPORTANTE</strong></p>
          <p class="mb-3">Esta herramienta es un <strong>estimador informativo</strong> y NO constituye asesor√≠a legal, financiera ni pensional certificada.</p>
          <p class="mb-3"><strong>1. Naturaleza del c√°lculo:</strong> Los resultados son estimaciones basadas en la informaci√≥n extra√≠da de su documento de Colpensiones y las f√≥rmulas establecidas en la Ley 797 de 2003 y normas concordantes. Los c√°lculos pueden diferir de la liquidaci√≥n oficial de Colpensiones.</p>
          <p class="mb-3"><strong>2. Sin almacenamiento de datos:</strong> Toda la informaci√≥n se procesa exclusivamente en su navegador. No almacenamos, transmitimos ni recopilamos su c√©dula, documento ni datos personales en ning√∫n servidor.</p>
          <p class="mb-3"><strong>3. Precisi√≥n:</strong> Los valores de IPC utilizados para indexaci√≥n son aproximaciones. El c√°lculo oficial de Colpensiones puede usar valores diferentes. Los resultados deben tomarse como referencia, no como liquidaci√≥n definitiva.</p>
          <p class="mb-3"><strong>4. No reemplaza asesor√≠a profesional:</strong> Para decisiones importantes sobre su pensi√≥n, consulte con un abogado laboralista o asesor pensional certificado.</p>
          <p class="mb-3"><strong>5. Limitaci√≥n de responsabilidad:</strong> No nos hacemos responsables por decisiones tomadas con base en los resultados de esta herramienta.</p>
          <p><strong>6. Aceptaci√≥n:</strong> Al continuar, usted acepta que comprende la naturaleza estimativa de esta herramienta y que la usa bajo su propia responsabilidad.</p>
        </div>

        <label class="flex items-center gap-3 mb-4 cursor-pointer">
          <input type="checkbox" id="terms-checkbox" class="w-5 h-5 rounded bg-slate-700 border-slate-600 text-blue-600 focus:ring-blue-500">
          <span class="text-slate-300 text-sm">He le√≠do y acepto los t√©rminos de servicio</span>
        </label>

        <button id="btn-accept-terms"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
          Acepto y Continuar
        </button>
      </div>
    </div>
  </div>

  <!-- VISTA 4: Resultados Gratuitos -->
  <div id="view-free" class="hidden">
    <div class="mb-8">
      <!-- Semanas totales -->
      <div class="bg-slate-800 rounded-xl p-8 border border-slate-700 text-center mb-6">
        <p class="text-slate-400 text-sm uppercase tracking-wider mb-2">Total Semanas Cotizadas</p>
        <p id="total-weeks" class="text-6xl font-bold text-white mb-2">0</p>
        <div id="verification-badge" class="text-sm"></div>
      </div>

      <!-- Edad y g√©nero -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div>
          <label class="block text-slate-400 text-sm mb-1">Su edad actual</label>
          <input type="number" id="input-age" min="18" max="80" value="55" class="text-center">
        </div>
        <div>
          <label class="block text-slate-400 text-sm mb-1">G√©nero</label>
          <select id="select-gender" class="w-full">
            <option value="M">Masculino (62 a√±os)</option>
            <option value="F">Femenino (57 a√±os)</option>
          </select>
        </div>
      </div>

      <!-- Empleadores -->
      <div class="mb-6">
        <h3 class="text-white font-semibold text-lg mb-3">Historial de Empleadores</h3>
        <div id="employer-list"></div>
      </div>

      <!-- Teaser de pensi√≥n -->
      <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 text-center relative overflow-hidden">
        <p class="text-slate-400 text-sm mb-2">Mesada Pensional Estimada</p>
        <p id="pension-teaser" class="text-4xl font-bold text-green-400 blur-teaser">$0</p>
        <div class="absolute inset-0 flex items-center justify-center bg-slate-800/70 backdrop-blur-sm">
          <div class="text-center">
            <p class="text-white font-semibold mb-2">üîí Contenido Premium</p>
            <p class="text-slate-400 text-sm mb-4">Desbloquee el reporte completo</p>
            <button id="btn-paywall" 
                    class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg transition-colors">
              Desbloquear Reporte ‚Ä¢ $350.000 COP
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- VISTA 5: Paywall -->
  <div id="view-paywall" class="hidden">
    <div class="max-w-lg mx-auto text-center py-8">
      <div class="text-5xl mb-6">üîì</div>
      <h2 class="text-2xl font-bold text-white mb-3">Desbloquear Reporte Completo</h2>
      <p class="text-slate-400 mb-8">Acceda a todos los c√°lculos detallados de su pensi√≥n</p>

      <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 mb-6 text-left">
        <h3 class="text-white font-semibold mb-4">Incluye:</h3>
        <ul class="space-y-3">
          <li class="flex items-center gap-3 text-slate-300">
            <span class="text-green-400">‚úì</span> Mesada pensional estimada (IBL detallado)
          </li>
          <li class="flex items-center gap-3 text-slate-300">
            <span class="text-green-400">‚úì</span> Tasa de reemplazo con desglose
          </li>
          <li class="flex items-center gap-3 text-slate-300">
            <span class="text-green-400">‚úì</span> Estado de elegibilidad y fecha proyectada
          </li>
          <li class="flex items-center gap-3 text-slate-300">
            <span class="text-green-400">‚úì</span> Buscador de Meta (pensi√≥n objetivo)
          </li>
          <li class="flex items-center gap-3 text-slate-300">
            <span class="text-green-400">‚úì</span> Calculadora de carga total (independientes)
          </li>
          <li class="flex items-center gap-3 text-slate-300">
            <span class="text-green-400">‚úì</span> Indemnizaci√≥n sustitutiva (si aplica)
          </li>
        </ul>
      </div>

      <div class="bg-blue-900/50 border border-blue-600 rounded-xl p-6 mb-6">
        <p class="text-3xl font-bold text-white mb-1">$350.000 <span class="text-lg text-slate-400">COP</span></p>
        <p class="text-slate-400 text-sm">Pago √∫nico ‚Äî acceso inmediato</p>
      </div>

      <!-- MVP: Bot√≥n de pago simulado -->
      <button id="btn-simulate-payment"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-lg transition-colors mb-3">
        üí≥ Pagar con MercadoPago
      </button>
      <p class="text-slate-500 text-xs">(MVP: el pago se simula al hacer clic)</p>

      <div class="mt-6">
        <button id="btn-back-free" class="text-slate-400 hover:text-white text-sm">‚Üê Volver a resultados gratuitos</button>
      </div>
    </div>
  </div>

  <!-- VISTA 6: Dashboard Premium -->
  <div id="view-dashboard" class="hidden">
    
    <!-- Mesada Pensional -->
    <div class="bg-gradient-to-br from-blue-900 to-slate-800 rounded-xl p-8 border border-blue-700 text-center mb-6">
      <p class="text-blue-300 text-sm uppercase tracking-wider mb-2">Su Mesada Pensional Estimada</p>
      <p id="dash-pension" class="text-5xl font-bold text-white mb-2">$0</p>
      <p class="text-blue-300 text-sm">mensual</p>
    </div>

    <!-- Grid de m√©tricas -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      
      <!-- IBL -->
      <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
        <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-3">Ingreso Base de Liquidaci√≥n</h3>
        <p id="dash-ibl" class="text-2xl font-bold text-white mb-1">$0</p>
        <p class="text-slate-400 text-sm">M√©todo: <span id="dash-ibl-method" class="text-blue-400">‚Äî</span></p>
        <div class="mt-3 pt-3 border-t border-slate-700 text-sm">
          <div class="flex justify-between text-slate-400">
            <span>√öltimos 10 a√±os:</span>
            <span id="dash-ibl-last10" class="text-white">$0</span>
          </div>
          <div class="flex justify-between text-slate-400 mt-1">
            <span>Vida laboral:</span>
            <span id="dash-ibl-lifetime" class="text-white">$0</span>
          </div>
        </div>
      </div>

      <!-- Tasa de Reemplazo -->
      <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
        <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-3">Tasa de Reemplazo</h3>
        <p id="dash-rate" class="text-2xl font-bold text-green-400 mb-1">0%</p>
        <div class="mt-3 pt-3 border-t border-slate-700 text-sm">
          <div class="flex justify-between text-slate-400">
            <span>Tasa base:</span>
            <span id="dash-rate-base" class="text-white">0%</span>
          </div>
          <div class="flex justify-between text-slate-400 mt-1">
            <span>Bonificaci√≥n semanas:</span>
            <span id="dash-rate-bonus" class="text-white">+0%</span>
          </div>
        </div>
      </div>

      <!-- Semanas -->
      <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
        <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-3">Cotizaci√≥n</h3>
        <div class="flex justify-between items-end">
          <div>
            <p class="text-slate-400 text-sm">Semanas</p>
            <p id="dash-weeks" class="text-2xl font-bold text-white">0</p>
          </div>
          <div class="text-right">
            <p class="text-slate-400 text-sm">Meses con aportes</p>
            <p id="dash-months" class="text-2xl font-bold text-white">0</p>
          </div>
        </div>
      </div>

      <!-- Elegibilidad -->
      <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
        <h3 class="text-slate-400 text-sm uppercase tracking-wider mb-3">Elegibilidad</h3>
        <div id="dash-eligibility"></div>
      </div>
    </div>

    <!-- Indemnizaci√≥n Sustitutiva -->
    <div id="dash-indemnizacion" class="hidden bg-yellow-900/30 border border-yellow-700 rounded-xl p-6 mb-6">
      <h3 class="text-yellow-400 font-semibold mb-2">‚ö† Indemnizaci√≥n Sustitutiva</h3>
      <p class="text-slate-300 text-sm mb-2">Si no alcanza las 1.300 semanas, puede solicitar una devoluci√≥n por:</p>
      <p id="dash-indemnizacion-value" class="text-2xl font-bold text-yellow-400">$0</p>
    </div>

    <!-- Herramientas Premium -->
    <div class="space-y-6">

      <!-- Goal Seeker -->
      <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
        <h3 class="text-white font-semibold text-lg mb-1">üéØ Buscador de Meta</h3>
        <p class="text-slate-400 text-sm mb-4">¬øCu√°nto debe cotizar para alcanzar su pensi√≥n objetivo?</p>
        
        <div class="flex gap-3 mb-4">
          <div class="flex-1">
            <label class="text-slate-400 text-xs block mb-1">Mesada objetivo (COP)</label>
            <input type="text" id="goal-target" placeholder="2.000.000">
          </div>
          <button id="btn-goal-seek" 
                  class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 rounded-lg self-end transition-colors">
            Calcular
          </button>
        </div>
        <div id="goal-results" class="space-y-3"></div>
      </div>

      <!-- Full Burden Calculator -->
      <div class="bg-slate-800 rounded-xl p-6 border border-slate-700">
        <h3 class="text-white font-semibold text-lg mb-1">üí∞ Calculadora de Carga Total</h3>
        <p class="text-slate-400 text-sm mb-4">Costo real mensual para independientes</p>
        
        <div class="flex gap-3 mb-4">
          <div class="flex-1">
            <label class="text-slate-400 text-xs block mb-1">IBC mensual (COP)</label>
            <input type="text" id="burden-ibc" placeholder="1.423.500">
          </div>
          <button id="btn-burden"
                  class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 rounded-lg self-end transition-colors">
            Calcular
          </button>
        </div>
        <div id="burden-results"></div>
      </div>

    </div>

    <!-- Footer -->
    <div class="text-center text-slate-500 text-xs mt-8 pb-8">
      <p>Estimaci√≥n basada en Ley 797 de 2003 ‚Ä¢ No constituye asesor√≠a legal</p>
      <p class="mt-1">Todos los c√°lculos se realizan localmente en su navegador</p>
    </div>
  </div>

</main>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
</script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
<script src="js/data.js"></script>
<script src="js/parser.js"></script>
<script src="js/calculator.js"></script>
<script src="js/optimizer.js"></script>
<script src="js/i18n.js"></script>
<script src="js/app.js"></script>
<script>applyTranslations();</script>

</body>
</html>
