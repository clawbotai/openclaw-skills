// data.js — Datos de referencia del sistema pensional colombiano

/** Salario Mínimo Mensual Legal Vigente por año */
const SMMLV = {
  1980:4500, 1981:5700, 1982:7410, 1983:9261, 1984:11298, 1985:13558,
  1986:16811, 1987:20510, 1988:25637, 1989:32560, 1990:41025, 1991:51720,
  1992:65190, 1993:81510, 1994:98700, 1995:118934, 1996:142125, 1997:172005,
  1998:203826, 1999:236460, 2000:260100, 2001:286000, 2002:309000, 2003:332000,
  2004:358000, 2005:381500, 2006:408000, 2007:433700, 2008:461500, 2009:496900,
  2010:515000, 2011:535600, 2012:566700, 2013:589500, 2014:616000, 2015:644350,
  2016:689455, 2017:737717, 2018:781242, 2019:828116, 2020:877803, 2021:908526,
  2022:1000000, 2023:1160000, 2024:1300000, 2025:1423500
};

const SMMLV_ACTUAL = 1423500;
const SMMLV_YEAR = 2025;

/** Tasas de cotización por período */
const CONTRIBUTION_RATES = [
  { start: 1967, end: 1993, rate: 0.10 },
  { start: 1994, end: 1995, rate: 0.115 },
  { start: 1996, end: 2003, rate: 0.135 },
  { start: 2004, end: 2007, rate: 0.145 },
  { start: 2008, end: 2025, rate: 0.16 }
];

/**
 * IPC mensual (Índice de Precios al Consumidor)
 * Fuente: DANE — Serie 1995-01 a 2025-12
 * Usado para indexación de salarios en cálculo de IBL
 */
const IPC_MONTHLY = {"1995-01":10.15,"1995-02":10.3,"1995-03":10.45,"1995-04":10.61,"1995-05":10.77,"1995-06":10.93,"1995-07":11.08,"1995-08":11.16,"1995-09":11.31,"1995-10":11.44,"1995-11":11.59,"1995-12":11.81,"1996-01":12.09,"1996-02":12.39,"1996-03":12.66,"1996-04":12.88,"1996-05":13.07,"1996-06":13.18,"1996-07":13.38,"1996-08":13.52,"1996-09":13.69,"1996-10":13.82,"1996-11":13.96,"1996-12":14.25,"1997-01":14.61,"1997-02":15.0,"1997-03":15.27,"1997-04":15.53,"1997-05":15.76,"1997-06":15.94,"1997-07":16.09,"1997-08":16.24,"1997-09":16.43,"1997-10":16.6,"1997-11":16.77,"1997-12":17.0,"1998-01":17.37,"1998-02":17.87,"1998-03":18.26,"1998-04":18.74,"1998-05":19.0,"1998-06":19.18,"1998-07":19.29,"1998-08":19.35,"1998-09":19.42,"1998-10":19.48,"1998-11":19.53,"1998-12":19.57,"1999-01":19.93,"1999-02":20.22,"1999-03":20.38,"1999-04":20.51,"1999-05":20.6,"1999-06":20.63,"1999-07":20.69,"1999-08":20.77,"1999-09":20.87,"1999-10":20.93,"1999-11":21.0,"1999-12":21.06,"2000-01":21.36,"2000-02":21.72,"2000-03":22.0,"2000-04":22.25,"2000-05":22.43,"2000-06":22.5,"2000-07":22.55,"2000-08":22.6,"2000-09":22.67,"2000-10":22.71,"2000-11":22.77,"2000-12":22.88,"2001-01":23.17,"2001-02":23.49,"2001-03":23.8,"2001-04":24.05,"2001-05":24.2,"2001-06":24.27,"2001-07":24.32,"2001-08":24.38,"2001-09":24.44,"2001-10":24.5,"2001-11":24.58,"2001-12":24.71,"2002-01":25.09,"2002-02":25.38,"2002-03":25.59,"2002-04":25.85,"2002-05":26.0,"2002-06":26.1,"2002-07":26.15,"2002-08":26.19,"2002-09":26.24,"2002-10":26.32,"2002-11":26.42,"2002-12":26.55,"2003-01":26.92,"2003-02":27.18,"2003-03":27.45,"2003-04":27.79,"2003-05":27.94,"2003-06":28.0,"2003-07":28.0,"2003-08":28.06,"2003-09":28.12,"2003-10":28.18,"2003-11":28.33,"2003-12":28.47,"2004-01":28.87,"2004-02":29.18,"2004-03":29.47,"2004-04":29.7,"2004-05":29.83,"2004-06":29.93,"2004-07":29.93,"2004-08":29.96,"2004-09":30.07,"2004-10":30.08,"2004-11":30.17,"2004-12":30.33,"2005-01":30.58,"2005-02":30.88,"2005-03":31.11,"2005-04":31.32,"2005-05":31.43,"2005-06":31.52,"2005-07":31.54,"2005-08":31.57,"2005-09":31.67,"2005-10":31.73,"2005-11":31.79,"2005-12":31.87,"2006-01":32.11,"2006-02":32.31,"2006-03":32.53,"2006-04":32.68,"2006-05":32.8,"2006-06":32.91,"2006-07":33.04,"2006-08":33.18,"2006-09":33.31,"2006-10":33.32,"2006-11":33.41,"2006-12":33.52,"2007-01":33.76,"2007-02":34.05,"2007-03":34.37,"2007-04":34.62,"2007-05":34.78,"2007-06":34.91,"2007-07":35.03,"2007-08":35.05,"2007-09":35.15,"2007-10":35.21,"2007-11":35.37,"2007-12":35.63,"2008-01":36.12,"2008-02":36.59,"2008-03":36.87,"2008-04":37.14,"2008-05":37.47,"2008-06":37.75,"2008-07":37.98,"2008-08":38.01,"2008-09":37.98,"2008-10":38.03,"2008-11":38.13,"2008-12":38.29,"2009-01":38.6,"2009-02":38.85,"2009-03":39.02,"2009-04":39.13,"2009-05":39.12,"2009-06":39.09,"2009-07":39.06,"2009-08":39.07,"2009-09":39.07,"2009-10":38.99,"2009-11":39.0,"2009-12":39.07,"2010-01":39.41,"2010-02":39.71,"2010-03":39.87,"2010-04":39.97,"2010-05":40.08,"2010-06":40.14,"2010-07":40.12,"2010-08":40.12,"2010-09":40.1,"2010-10":40.12,"2010-11":40.28,"2010-12":40.49,"2011-01":40.88,"2011-02":41.23,"2011-03":41.46,"2011-04":41.61,"2011-05":41.71,"2011-06":41.82,"2011-07":41.86,"2011-08":41.87,"2011-09":41.97,"2011-10":42.11,"2011-11":42.24,"2011-12":42.42,"2012-01":42.77,"2012-02":43.04,"2012-03":43.19,"2012-04":43.29,"2012-05":43.39,"2012-06":43.44,"2012-07":43.41,"2012-08":43.41,"2012-09":43.5,"2012-10":43.6,"2012-11":43.61,"2012-12":43.62,"2013-01":43.85,"2013-02":44.11,"2013-03":44.24,"2013-04":44.4,"2013-05":44.52,"2013-06":44.6,"2013-07":44.56,"2013-08":44.57,"2013-09":44.68,"2013-10":44.62,"2013-11":44.55,"2013-12":44.73,"2014-01":45.12,"2014-02":45.42,"2014-03":45.63,"2014-04":45.82,"2014-05":46.0,"2014-06":46.06,"2014-07":46.07,"2014-08":46.13,"2014-09":46.2,"2014-10":46.27,"2014-11":46.36,"2014-12":46.47,"2015-01":46.78,"2015-02":47.26,"2015-03":47.52,"2015-04":47.78,"2015-05":47.92,"2015-06":48.0,"2015-07":48.1,"2015-08":48.29,"2015-09":48.58,"2015-10":48.79,"2015-11":49.01,"2015-12":49.38,"2016-01":49.96,"2016-02":50.62,"2016-03":51.0,"2016-04":51.31,"2016-05":51.55,"2016-06":51.75,"2016-07":51.92,"2016-08":51.82,"2016-09":51.87,"2016-10":51.87,"2016-11":51.99,"2016-12":52.15,"2017-01":52.61,"2017-02":53.1,"2017-03":53.28,"2017-04":53.44,"2017-05":53.52,"2017-06":53.63,"2017-07":53.61,"2017-08":53.65,"2017-09":53.73,"2017-10":53.76,"2017-11":53.89,"2017-12":54.07,"2018-01":54.51,"2018-02":54.89,"2018-03":55.07,"2018-04":55.28,"2018-05":55.39,"2018-06":55.49,"2018-07":55.54,"2018-08":55.6,"2018-09":55.68,"2018-10":55.78,"2018-11":55.83,"2018-12":55.9,"2019-01":56.22,"2019-02":56.47,"2019-03":56.68,"2019-04":56.93,"2019-05":57.13,"2019-06":57.28,"2019-07":57.37,"2019-08":57.44,"2019-09":57.55,"2019-10":57.65,"2019-11":57.77,"2019-12":57.97,"2020-01":58.28,"2020-02":58.51,"2020-03":58.67,"2020-04":58.76,"2020-05":58.67,"2020-06":58.63,"2020-07":58.69,"2020-08":58.69,"2020-09":58.71,"2020-10":58.68,"2020-11":58.63,"2020-12":58.7,"2021-01":59.14,"2021-02":59.48,"2021-03":59.82,"2021-04":60.1,"2021-05":60.35,"2021-06":60.57,"2021-07":60.63,"2021-08":60.71,"2021-09":60.88,"2021-10":61.14,"2021-11":61.56,"2021-12":62.12,"2022-01":62.96,"2022-02":63.69,"2022-03":64.33,"2022-04":65.22,"2022-05":65.83,"2022-06":66.57,"2022-07":67.04,"2022-08":67.3,"2022-09":67.73,"2022-10":68.07,"2022-11":68.43,"2022-12":68.94,"2023-01":69.93,"2023-02":70.7,"2023-03":71.21,"2023-04":71.75,"2023-05":71.94,"2023-06":72.2,"2023-07":72.37,"2023-08":72.46,"2023-09":72.61,"2023-10":72.6,"2023-11":72.65,"2023-12":72.78,"2024-01":73.56,"2024-02":74.42,"2024-03":74.92,"2024-04":75.36,"2024-05":75.56,"2024-06":75.72,"2024-07":75.84,"2024-08":75.82,"2024-09":75.87,"2024-10":75.89,"2024-11":76.06,"2024-12":76.26,"2025-01":76.73,"2025-02":77.18,"2025-03":77.68,"2025-04":78.13,"2025-05":78.56,"2025-06":79.0,"2025-07":79.42,"2025-08":79.85,"2025-09":80.26,"2025-10":80.68,"2025-11":81.1,"2025-12":81.52};

const PENSION_AGE = { M: 62, F: 57 };
const MIN_WEEKS = 1300;
const IBC_CAP_SMMLV = 25;

function getContributionRate(year) {
  for (const r of CONTRIBUTION_RATES) {
    if (year >= r.start && year <= r.end) return r.rate;
  }
  return 0.16;
}

/**
 * Obtener IPC para un año y mes específico.
 * Si no existe el mes exacto, busca el más cercano del mismo año.
 */
function getIPCMonthly(year, month) {
  const key = `${year}-${String(month).padStart(2, '0')}`;
  if (IPC_MONTHLY[key]) return IPC_MONTHLY[key];

  // Buscar último mes disponible del mismo año
  for (let m = month; m >= 1; m--) {
    const k = `${year}-${String(m).padStart(2, '0')}`;
    if (IPC_MONTHLY[k]) return IPC_MONTHLY[k];
  }
  // Buscar diciembre del año anterior
  const prevKey = `${year - 1}-12`;
  if (IPC_MONTHLY[prevKey]) return IPC_MONTHLY[prevKey];

  return null;
}

function formatCOP(value) {
  return '$ ' + Math.round(value).toLocaleString('es-CO');
}

function parseColNumber(str) {
  if (str == null) return 0;
  if (typeof str === 'number') return str;
  str = String(str).trim().replace(/\$/g, '').replace(/\s/g, '');
  if (!str) return 0;

  const dots = (str.match(/\./g) || []).length;
  const commas = (str.match(/,/g) || []).length;

  if (dots > 1) {
    // 1.234.567,89 o 1.234.567
    str = str.replace(/\./g, '').replace(',', '.');
  } else if (dots === 1 && commas > 0) {
    // 1.234,56
    str = str.replace('.', '').replace(',', '.');
  } else if (dots === 1 && commas === 0) {
    const parts = str.split('.');
    if (parts[1].length === 3) {
      // 1.234 → miles
      str = str.replace('.', '');
    }
    // else: decimal (1234.5)
  } else if (commas > 0) {
    // 1234,56
    str = str.replace(',', '.');
  }

  const n = parseFloat(str);
  return isNaN(n) ? 0 : n;
}

function parseColDate(str) {
  if (!str) return null;
  str = String(str).trim();

  // Quitar componente hora si existe
  if (str.includes(' ')) str = str.split(' ')[0];

  // YYYY-MM-DD
  if (/^\d{4}-\d{2}-\d{2}$/.test(str)) {
    const [y, m, d] = str.split('-').map(Number);
    return new Date(y, m - 1, d);
  }
  // DD/MM/YYYY
  if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(str)) {
    const [d, m, y] = str.split('/').map(Number);
    return new Date(y, m - 1, d);
  }
  return null;
}
