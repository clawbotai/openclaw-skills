# 2026-02-14

## Forge Daemon v3.0 — Gemini CLI Research

Steven curled local ports 54747 (HTTPS) and 54738 (HTTP) from his MacBook Pro — these are **Antigravity IDE's internal language server**. Key findings from deep research:

### Antigravity Language Server (NOT the right path)
- Go binary, random port + CSRF token per session (`--extension_server_port`, `--csrf_token`)
- CSRF header is `x-codeium-csrf-token` (not `x-csrf-token` — that's why his curl got "Invalid CSRF token")
- Token + port visible in `ps aux | grep language_server` on the MacBook
- Internal protobuf/gRPC-ish protocol, undocumented, breaks on updates — **fragile, not recommended**

### Gemini CLI Headless Mode (CORRECT path) ⭐
- `npm install -g @google/gemini-cli`
- `gemini --prompt "task" --output-format json --yolo` (headless, auto-approve, JSON output)
- Streaming: `--output-format stream-json` (JSONL events: init, message, tool_use, tool_result, error, result)
- Auth: `gemini auth login` (Google OAuth, uses paid-tier subscription)
- **No API keys needed** — routes through Google account auth
- Official, documented, stable interface

### antigravity-claude-proxy (BANNED — do NOT use)
- Google actively banning accounts that use it
- Repo has giant warning at top

### Next Steps
1. Steven needs to install `gemini` CLI on his MacBook: `npm install -g @google/gemini-cli`
2. Auth once: `gemini auth login`
3. Update `antigravity-worker.ts` to use: `gemini -p "<prompt>" --output-format json --yolo`
4. Remove `@google/genai` from package.json

### Completed
- Gemini CLI installed on both MacBook Pro and Mac mini (`npm install -g @google/gemini-cli`)
- Auth: OAuth personal, credentials copied from MacBook → Mac mini via scp
- Settings: `previewFeatures: true` enables Gemini 3
- Model name: `gemini-3-pro-preview` (not `gemini-3-pro`)
- Auto-routing uses `gemini-2.5-flash-lite` (router) + `gemini-3-flash-preview` (main)
- Daemon updated: `cat <prompt> | gemini --output-format json --model gemini-3-pro-preview`
- Verified end-to-end on Mac mini — Gemini 3 Pro responding
- Commits: `64b46af` (v3.0 Gemini CLI integration), `e8cbde4` (gemini-3-pro-preview model)
